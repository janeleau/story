<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jane的小说网站</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/valine.min.css">
          <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color:#fff9e6;
            color: #333;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* 头部样式 */
        header {
            background-color: #f8e58c;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

        .logo a {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d35400;
        }

        nav ul {
            display: flex;
            list-style: none;
        }

        nav ul li {
            margin-left: 1.5rem;
        }

        nav ul li a {
            text-decoration: none;
            color: #d35400;
            font-weight: 500;
            transition: color 0.3s;
        }

        nav ul li a:hover {
            color: #a04000;
        }

        /* 主要内容区域 */
        main {
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
        }

        /* 搜索框样式 */
        .search-section {
            margin-bottom: 2rem;
            text-align: center;
            position: relative;
            z-index: 10;
        }

        #search-input {
            width: 100%;
            max-width: 500px;
            padding: 0.8rem 1rem;
            border: 2px solid #f5d76e;
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
            background-color: rgba(255, 255, 255, 0.8);
        }

        #search-input:focus {
            border-color: #f39c12;
            box-shadow: 0 0 10px rgba(243, 156, 18, 0.3);
        }

        /* 小说列表样式 */
        .novel-list h2, .about-section h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: #d35400;
            position: relative;
        }

        .novels-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            position: relative;
        }

        /* 小说卡片样式 */
        .novel-card {
            background-color: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
            cursor: pointer;
            position: relative;
            z-index: 5;
        }

        .novel-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .novel-card h3 {
            color: #d35400;
            margin-bottom: 0.5rem;
        }

        .novel-card p {
            color: #666;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .novel-card .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .novel-card .tag {
            background-color: #f5d76e;
            color: #d35400;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }

        .novel-card .details-btn {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            width: 100%;
        }

        .novel-card .details-btn:hover {
            background-color: #d35400;
        }

        /* 关于区域样式 */
        .about-section {
            background-color: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            position: relative;
            z-index: 5;
        }

        .about-content p {
            margin-bottom: 1rem;
            text-align: center;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal-content {
            background-color: rgba(255, 249, 230, 0.95);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            max-width: 800px;
            width: 90%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            color: #d35400;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: #a04000;
        }

        /* 卷列表样式 */
        .volumes-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .volume-card {
            background-color: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .volume-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .volume-card h3 {
            color: #d35400;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        /* 全屏阅读样式 */
        .fullscreen-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,250,250, 1);
            z-index: 3000;
            overflow-y: auto;
            padding: 2rem;
            overflow: hidden;
        }

        .fullscreen-content {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .reader-controls {
            position: fixed;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 1rem;
            z-index: 3001;
        }

        .reader-btn {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reader-btn:hover {
            background-color: #d35400;
            transform: scale(1.05);
        }

        .reader-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .chapter-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #f5d76e;
        }

        .chapter-text {
            line-height: 1.8;
            font-size: 1.1rem;
            position: relative;
            z-index: 5;
        }

        .chapter-text p {
            margin-bottom: 1.5rem;
            text-indent: 2em;
        }

        #reader-title small {
            font-size: 0.8em;
            color: #666;
        }

        /* 粉色雨滴效果 */
        .reader-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .reader-drop {
            position: absolute;
            width: 1px;
            height: 30px;
            background: linear-gradient(to bottom, transparent, rgba(255, 182, 193, 0.6));
            animation: rainDrop 1.5s linear infinite;
        }

        @keyframes rainDrop {
            0% {
                transform: translateY(-50px);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh);
                opacity: 0;
            }
        }

        /* 粉色涟漪效果 */
        .reader-ripple {
            position: absolute;
            width: 10px;
            height: 5px;
            background: rgba(255, 182, 193, 0.4);
            border-radius: 50%;
            animation: rippleEffect 1s ease-out;
            transform: scale(0);
        }

        @keyframes rippleEffect {
            to {
                transform: scale(6);
                opacity: 0;
            }
        }

        /* 返回按钮样式 */
        .back-btn {
            background-color: #f39c12;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 1rem;
        }

        .back-btn:hover {
            background-color: #d35400;
        }

        /* 动画效果 */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                padding: 1rem;
            }

            .logo {
                margin-bottom: 1rem;
            }

            nav ul {
                flex-direction: column;
                align-items: center;
            }

            nav ul li {
                margin: 0.5rem 0;
            }

            .novels-container {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .reader-controls {
                top: auto;
                bottom: 1rem;
                right: 50%;
                transform: translateX(50%);
                flex-wrap: wrap;
                justify-content: center;
            }

            .reader-btn {
                margin: 0.2rem;
            }
        }

        /* 下拉阅读功能样式 */
        .fullscreen-modal {
            overscroll-behavior-y: contain; /* 防止页面整体下拉刷新 */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* iOS平滑滚动 */
        }

        /* 章节内容分块 */
        .chapter-page {
            min-height: 100vh;
            padding: 2rem 0;
            box-sizing: border-box;
        }

        /* 触摸反馈效果 */
        .chapter-text {
            transition: transform 0.2s ease-out;
        }

        /* 评论区样式 */
        .comments-section {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 2px solid #f5d76e;
        }

        .comments-section h3 {
            color: #d35400;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .comment-form {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .comment-form input,
        .comment-form textarea {
            width: 100%;
            padding: 0.8rem;
            margin-bottom: 1rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .comment-form input:focus,
        .comment-form textarea:focus {
            outline: none;
            border-color: #f39c12;
            box-shadow: 0 0 5px rgba(243, 156, 18, 0.3);
        }

        .comment-notice {
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            margin-top: 1rem;
        }

        .comments-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .comment-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .comment-author {
            font-weight: bold;
            color: #d35400;
        }

        .comment-date {
            font-size: 0.8rem;
            color: #666;
        }

        .comment-content {
            line-height: 1.6;
            color: #333;
        }

        .comment-loading,
        .no-comments,
        .comment-error {
            text-align: center;
            padding: 2rem;
            color: #666;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .comment-error {
            color: #e74c3c;
            background: #ffeaea;
        }

        /* Valine评论样式适配 */
        #vcomments {
            margin-top: 20px;
        }

        .v {
            font-family: 'Microsoft YaHei', sans-serif !important;
        }

        .v .vbtn {
            background-color: #f39c12 !important;
            border: 1px solid #f39c12 !important;
            color: white !important;
        }

        .v .vbtn:hover {
            background-color: #d35400 !important;
            border-color: #d35400 !important;
        }

        .v .vnick:focus,
        .v .vmail:focus,
        .v .vlink:focus,
        .v .vedit textarea:focus {
            border-color: #f39c12 !important;
            box-shadow: 0 0 5px rgba(243, 156, 18, 0.3) !important;
        }

        .v .vcount {
            color: #d35400 !important;
        }

        .v .vnick,
        .v .vmail,
        .v .vlink {
            border-radius: 5px !important;
            border: 1px solid #ddd !important;
        }

        .v .vpanel {
            border-radius: 10px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
        }

        .v .vlist {
            border-radius: 10px !important;
        }

        .v .vcard {
            border-radius: 10px !important;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1) !important;
        }

        .v .vcontent {
            color: #333 !important;
            font-size: 16px !important;
            line-height: 1.6 !important;
        }

        .v .vat {
            color: #d35400 !important;
        }

        .v .vat:hover {
            color: #a04000 !important;
        }

        .v .vmeta .vat {
            background-color: #f39c12 !important;
            border-radius: 3px !important;
            padding: 2px 8px !important;
        }

        .v .vmeta .vat:hover {
            background-color: #d35400 !important;
        }

        .v .vempty {
            color: #666 !important;
            text-align: center !important;
            padding: 20px !important;
        }

        /* 评论删除按钮样式 */
        .comment-delete-btn {
            background: none;
            border: none;
            color: #e74c3c;
            cursor: pointer;
            margin-left: 10px;
            font-size: 14px;
            opacity: 0.7;
            transition: opacity 0.3s;
        }

        .comment-delete-btn:hover {
            opacity: 1;
        }

        /* 消息提示样式 */
        .comment-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 15px;
            border-radius: 5px;
            z-index: 10000;
            color: white;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .comment-success {
            background: #27ae60;
        }

        .comment-error {
            background: #e74c3c;
        }

        .comment-info {
            background: #3498db;
        }

        /* 评论加载中样式 */
        .comment-loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* 无评论提示 */
        .no-comments {
            text-align: center;
            padding: 30px;
            color: #666;
            font-style: italic;
        }

        /* 移动端适配 */
        @media (max-width: 768px) {
            .v .vpanel,
            .v .vlist {
                padding: 10px !important;
            }
            
            .v .vbtn {
                width: 100% !important;
                margin-bottom: 10px !important;
            }
            
            .v .vcol-20,
            .v .vcol-80 {
                width: 100% !important;
            }
        }
    
        
    
    </style>
</head>
<body>
    <!-- 页面主体结构保持不变 -->
     <header>
        <div class="logo">
            <a href="#" id="home-link">Jane的小说网站</a>
        </div>
        <nav>
            <ul>
                <li><a href="#fiction" id="fiction-link">非虚构小说</a></li>
                <li><a href="#fiction" id="fiction-all-link">虚构小说</a></li>
                <li><a href="#about" id="about-link">关于</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- 搜索区域 -->
        <section class="search-section">
            <input type="text" id="search-input" placeholder="搜索..." autocomplete="off">
        </section>

        <!-- 小说列表区域 - 默认显示 -->
        <section class="novel-list" id="novel-section">
            <h2>我的小说</h2>
            <div class="novels-container" id="novels-container">
                <!-- 小说卡片将通过JavaScript动态生成 -->
            </div>
        </section>

        <!-- 关于区域 - 默认隐藏 -->
        <section class="about-section" id="about-section" style="display: none;">
            <h2>关于作者</h2>
            <div class="about-content">
                <p>大家好，我是Jane，一名热爱写作的创作者。</p>
                <p>我的小说主要聚焦于现实生活中的情感故事，希望通过文字传递温暖和力量。</p>
                <p>写作是我表达自我的方式，也是我与世界对话的桥梁。</p>
                <p>感谢你的阅读和支持！</p>
            </div>
        </section>

        <!-- 小说详情模态框 - 默认隐藏 -->
        <div class="modal" id="novel-modal">
            <div class="modal-content">
                <span class="close-btn">&times;</span>
                <h2 id="modal-title">小说详情</h2>
                <div class="volumes-container" id="volumes-container">
                    <!-- 卷列表将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 全屏阅读模态框 -->
        <div class="fullscreen-modal" id="fullscreen-reader" style="display: none;">
            <div class="reader-controls">
                <button class="reader-btn" id="prev-chapter">上一章</button>
                <button class="reader-btn" id="next-chapter">下一章</button>
                <button class="reader-btn" id="close-reader">关闭</button>
            </div>
            <div class="fullscreen-content">
                <h2 id="reader-title">章节标题</h2>
                <div class="chapter-text" id="reader-content">
                    <!-- 章节内容将在这里显示 -->
                </div>
                
                <!-- 评论区 - 修改为Valine容器 -->
                <div class="comments-section" id="comments-section">
                    <h3>读者评论</h3>
                    <div id="vcomments"></div>
                </div>
                
                <div class="chapter-navigation">
                    <button class="reader-btn" id="back-to-volumes">返回目录</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="copyright">© 2025 Jane Novel Hub</div>
        <div class="social-links">
            <a href="https://github.com" target="_blank"><i class="fab fa-github"></i></a>
            <a href="https://bilibili.com" target="_blank"><i class="fab fa-bilibili"></i></a>
        </div>
    </footer>

    <!-- 添加Valine JS -->
    <script src="https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.13.2/dist/av-min.js"></script>
    
    <script>
        // 小说数据结构修改为使用文件路径
        const novelsData = [
            {
                id: 1,
                title: "贵妃，你怎么才找到我",
                description: "讲述贵妃与皇帝之间复杂的情感纠葛。",
                tags: ["情侣"],
                volumes: [
                    {
                        title: "第一卷",
                        chapters: [
                            {
                                title: "第一章",
                                file: "files/data1/volume1/chapter1.html" // 使用相对路径
                            },
                           {
                                title: "第二章",
                                file: "files/data1/volume1/chapter2.html"
                            },
                            {
                                title: "第三章",
                                 file: "files/data1/volume1/chapter3.html" 
                            },
                            {
                                title: "第四章",
                                 file: "files/data1/volume1/chapter4.html" 
                            }
                        ]
                    },
                    {
                        title: "第二卷：情愫",
                        chapters: [
                            {
                                title: "第一章 御花园偶遇",
                                content: "那日我在御花园赏花，不期然遇见了独自散步的皇帝。他见到我时，眼中闪过一丝惊讶，随即露出了难得的笑容。我们聊起了诗词歌赋，竟发现彼此有着相似的喜好..."
                            },
                            {
                                title: "第二章 宫中的嫉妒",
                                content: "自从那次御花园相遇后，皇帝来我宫中的次数明显增多。这引起了其他妃嫔的不满，各种流言蜚语开始在宫中流传。我知道，真正的考验才刚刚开始..."
                            }
                        ]
                    },
                    {
                        title: "第三卷：危机",
                        chapters: [
                            {
                                title: "第一章 皇后的警告",
                                content: "皇后终于按捺不住，亲自来到我的宫中。她表面上关心我的起居，言语间却处处暗示我不要太接近皇帝。我知道，这是她对我的正式警告..."
                            },
                            {
                                title: "第二章 阴谋",
                                content: "宫中突然传出有妃嫔怀孕的消息，而这个人竟是我宫中的侍女。更令人震惊的是，她声称孩子是皇帝的。我知道这是一个精心设计的陷阱，但我该如何证明自己的清白..."
                            },
                            {
                                title: "第三章 真相大白",
                                content: "经过一番调查，我终于找到了证据证明那侍女的孩子并非皇帝所出。然而，当我准备揭穿这一切时，却发现背后隐藏着一个更大的阴谋..."
                            }
                        ]
                    }
                ]
            },
            {
                id: 2,
                title: "长安十二时辰",
                description: "在长安城最危险的十二个时辰里，一个死囚与一名女捕快联手阻止了一场惊天阴谋。",
                tags: ["悬疑", "历史", "动作"],
                volumes: [
                    {
                        title: "第一卷：危机初现",
                        chapters: [
                            {
                                title: "第一章 死囚出狱",
                                content: "长安城的清晨，我——一个被判死刑的囚犯，被秘密带出了监狱。带我出来的是一名女捕快，她告诉我，长安城正面临一场前所未有的危机，而我是唯一能帮助她的人..."
                            },
                            {
                                title: "第二章 第一个线索",
                                content: "在长安城最繁华的东市，我们找到了第一个线索——一家突然关闭的香料铺。铺子里残留的奇怪气味让我想起了西域某种致命的毒药..."
                            }
                        ]
                    },
                    {
                        title: "第二卷：追捕",
                        chapters: [
                            {
                                title: "第一章 地下密道",
                                content: "追查线索的过程中，我们意外发现了长安城地下纵横交错的密道网络。这些密道通向城中各处重要地点，显然是阴谋者精心准备的逃生路线..."
                            },
                            {
                                title: "第二章 敌人的真面目",
                                content: "当我们终于截获一名信使时，从他口中得知了一个惊人的消息：这次阴谋的主使者，竟然是..."
                            }
                        ]
                    }
                ]
            },
            {
                id: 3,
                title: "青丘狐传说",
                description: "一位书生无意中救下一只受伤的白狐，从此卷入人妖两界的纷争。",
                tags: ["奇幻", "爱情", "妖怪"],
                volumes: [
                    {
                        title: "第一卷：相遇",
                        chapters: [
                            {
                                title: "第一章 雪夜救狐",
                                content: "那是一个风雪交加的夜晚，我从书院回家的路上，发现了一只受伤的白狐。它美丽的眼睛中闪烁着人类般的智慧光芒，让我无法弃之不顾..."
                            },
                            {
                                title: "第二章 狐女报恩",
                                content: "三天后的满月之夜，一位白衣女子出现在我的书房。她自称是我救下的白狐，前来报恩。从此，我的平凡生活被彻底改变..."
                            }
                        ]
                    },
                    {
                        title: "第二卷：纷争",
                        chapters: [
                            {
                                title: "第一章 猎妖师",
                                content: "一位神秘的猎妖师来到小镇，他敏锐地察觉到了妖气，开始四处搜寻。我必须想办法保护她，但作为一个普通书生，我能做什么..."
                            },
                            {
                                title: "第二章 青丘的秘密",
                                content: "她终于向我坦白了自己的身份——她不是普通的狐妖，而是青丘狐族的公主。因为族内叛乱而流落人间，现在叛军派出的杀手已经追踪到了这里..."
                            }
                        ]
                    }
                ]
            }
        ];


        // 新增函数：加载文本文件内容
        async function loadChapterContent(filePath) {
            try {
                // 显示加载指示器
                document.getElementById('reader-content').innerHTML = `
                    <div class="loading-indicator">
                        <div class="loading-spinner"></div>
                        <p>正在加载内容...</p>
                    </div>
                `;
                
                const response = await fetch(filePath);
                
                if (!response.ok) {
                    throw new Error(`文件加载失败: ${response.status} ${response.statusText}`);
                }
                
                const content = await response.text();
                return content;
            } catch (error) {
                console.error('加载章节内容时出错:', error);
                throw error;
            }
        }
     // DOM元素
        const novelsContainer = document.getElementById('novels-container');
        const searchInput = document.getElementById('search-input');
        const novelSection = document.getElementById('novel-section');
        const aboutSection = document.getElementById('about-section');
        const fictionLink = document.getElementById('fiction-link');
        const aboutLink = document.getElementById('about-link');
        const fictionAllLink = document.getElementById('fiction-all-link');
        const novelModal = document.getElementById('novel-modal');
        const fullscreenReader = document.getElementById('fullscreen-reader');
        const closeBtns = document.querySelectorAll('.close-btn');
        const volumesContainer = document.getElementById('volumes-container');
        const homeLink = document.getElementById('home-link');

        // 当前阅读状态
        let currentNovelId = null;
        let currentNovel = null;
        let currentVolumeIndex = 0;
        let currentChapterIndex = 0;
        let rainInterval;
        let currentChapterTitle = '';
        let currentChapterIdentifier = '';
        let valineInstance = null;

        // Valine配置
        const valineConfig = {
            appId: '7VUQAAaWZARxazhDAA9DmIay-gzGzoHsz',
            appKey: 'DznETOpf40sXQKeYrZNYYPs1',
            placeholder: '欢迎评论~ (支持Markdown语法)',
            path: window.location.pathname,
            avatar: 'mp',
            meta: ['nick', 'mail', 'link'],
            pageSize: 10,
            lang: 'zh-CN',
            highlight: true,
            recordIP: true,
            serverURLs: '',
            emojiCDN: '',
            emojiMaps: null,
            enableQQ: false,
            requiredFields: []
        };

        // 管理员配置
        const adminEmails = ['admin@example.com', 'jane@example.com']; // 替换为实际的管理员邮箱

        // 生成阅读界面雨滴效果
        function createReaderRain() {
            const rainContainer = document.createElement('div');
            rainContainer.className = 'reader-rain';
            fullscreenReader.appendChild(rainContainer);
            
            // 生成雨滴
            const dropsCount = Math.floor(window.innerWidth / 2);
            for (let i = 0; i < dropsCount; i++) {
                const drop = document.createElement('div');
                drop.className = 'reader-drop';
                
                // 随机属性
                const left = Math.random() * 100;
                const delay = Math.random() * 2;
                const duration = 0.5 + Math.random() * 1.5;
                const height = 20 + Math.random() * 40;
                const opacity = 0.3 + Math.random() * 0.5;
                const width = 0.5 + Math.random() * 1.5;
                
                drop.style.left = `${left}%`;
                drop.style.animationDelay = `${delay}s`;
                drop.style.animationDuration = `${duration}s`;
                drop.style.height = `${height}px`;
                drop.style.opacity = opacity;
                drop.style.width = `${width}px`;
                
                rainContainer.appendChild(drop);
            }
            
            // 生成涟漪
            rainInterval = setInterval(() => {
                const ripple = document.createElement('div');
                ripple.className = 'reader-ripple';
                ripple.style.left = `${Math.random() * 100}%`;
                ripple.style.top = `${85 + Math.random() * 15}%`;
                rainContainer.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 1000);
            }, 150);
        }

        // 清除雨滴效果
        function clearRainEffect() {
            clearInterval(rainInterval);
            const rain = document.querySelector('.reader-rain');
            if (rain) rain.remove();
        }

        // 初始化页面
        document.addEventListener('DOMContentLoaded', function() {
            // 渲染所有小说
            renderNovels(novelsData);
            
            // 设置导航链接事件
            setupNavigation();
            setupHomeLink();
            // 设置搜索功能
            setupSearch();
            
            // 设置模态框关闭事件
            setupModalClose();
            
            // 初始化阅读器控制
            initReaderControls();
        });

        /**
         * 渲染小说列表
         * @param {Array} novels - 小说数据数组
         */
        function renderNovels(novels) {
            novelsContainer.innerHTML = '';
            
            novels.forEach((novel, index) => {
                const card = document.createElement('div');
                card.className = 'novel-card';
                card.style.animationDelay = `${index * 0.1}s`;
                
                card.innerHTML = `
                    <h3>${novel.title}</h3>
                    <p>${novel.description}</p>
                    <div class="tags">
                        ${novel.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                    <button class="details-btn" data-id="${novel.id}">查看详情</button>
                `;
                
                novelsContainer.appendChild(card);
            });
            
            // 为详情按钮添加事件
            document.querySelectorAll('.details-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const novelId = parseInt(this.getAttribute('data-id'));
                    showNovelDetails(novelId);
                });
            });
        }

        /**
         * 显示小说详情（卷列表）
         * @param {number} novelId - 小说ID
         */
        function showNovelDetails(novelId) {
            currentNovelId = novelId;
            currentNovel = novelsData.find(n => n.id === novelId);
            
            if (!currentNovel) return;
            
            document.getElementById('modal-title').textContent = currentNovel.title;
            volumesContainer.innerHTML = '';
            
            // 添加返回按钮
            const backButton = document.createElement('button');
            backButton.className = 'back-btn';
            backButton.textContent = '返回小说列表';
            backButton.addEventListener('click', function() {
                novelModal.style.display = 'none';
            });
            volumesContainer.appendChild(backButton);
            
            // 添加卷列表
            currentNovel.volumes.forEach((volume, index) => {
                const volumeCard = document.createElement('div');
                volumeCard.className = 'volume-card';
                volumeCard.innerHTML = `<h3>${volume.title}</h3>`;
                
                volumeCard.addEventListener('click', function() {
                    showChapters(novelId, volume, index);
                });
                
                volumesContainer.appendChild(volumeCard);
            });
            
            novelModal.style.display = 'block';
        }
            
        /**
         * 显示章节列表
         * @param {number} novelId - 小说ID
         * @param {Object} volume - 卷数据
         * @param {number} volumeIndex - 卷索引
         */
        function showChapters(novelId, volume, volumeIndex) {
            const novel = novelsData.find(n => n.id === novelId);
            if (!novel) return;
            
            volumesContainer.innerHTML = '';
            
            // 添加返回按钮
            const backButton = document.createElement('button');
            backButton.className = 'back-btn';
            backButton.textContent = '返回卷列表';
            backButton.addEventListener('click', function() {
                showNovelDetails(novelId);
            });
            volumesContainer.appendChild(backButton);
            
            // 添加章节列表
            volume.chapters.forEach((chapter, index) => {
                const chapterCard = document.createElement('div');
                chapterCard.className = 'volume-card';
                chapterCard.innerHTML = `<h3>${chapter.title}</h3>`;
                
                chapterCard.addEventListener('click', function() {
                    showChapterContent(novel.title, volume.title, chapter, index, volumeIndex);
                });
                
                volumesContainer.appendChild(chapterCard);
            });
        }


        // 修改showChapterContent函数以加载外部文件
        async function showChapterContent(novelTitle, volumeTitle, chapter, chapterIndex, volumeIndex) {
            currentChapterIndex = chapterIndex;
            currentVolumeIndex = volumeIndex;
            
            // 设置全屏阅读器内容
            document.getElementById('reader-title').innerHTML = `
                ${novelTitle} <small>> ${volumeTitle} > ${chapter.title}</small>
            `;
            
            // 显示加载指示器
            document.getElementById('reader-content').innerHTML = `
                <div class="loading-indicator">
                    <div class="loading-spinner"></div>
                    <p>正在加载内容...</p>
                </div>
            `;
            
            try {
                // 加载外部文件内容
                const content = await loadChapterContent(chapter.file);
                
                // 显示内容
                document.getElementById('reader-content').innerHTML = `
                    <p>${content}</p>
                `;
            } catch (error) {
                // 显示错误信息
                document.getElementById('reader-content').innerHTML = `
                    <div class="error-message">
                        <p>加载内容时出错: ${error.message}</p>
                        <p>请检查文件路径是否正确: ${chapter.file}</p>
                    </div>
                `;
            }
            
            // 隐藏其他模态框，显示全屏阅读器
            novelModal.style.display = 'none';
            fullscreenReader.style.display = 'block';
            
            // 创建雨滴效果
            clearRainEffect();
            createReaderRain();
            
            // 更新导航按钮状态
            updateReaderNavButtons();
            initPullToRead();
            
            // 初始化Valine评论系统
            setTimeout(() => {
                initValine(novelTitle, volumeTitle, chapter.title);
            }, 500);
        }

        // 修改章节导航函数以支持异步加载
        document.getElementById('prev-chapter').addEventListener('click', async function() {
            if (currentChapterIndex > 0) {
                const prevChapter = currentNovel.volumes[currentVolumeIndex].chapters[currentChapterIndex - 1];
                await showChapterContent(
                    currentNovel.title,
                    currentNovel.volumes[currentVolumeIndex].title,
                    prevChapter,
                    currentChapterIndex - 1,
                    currentVolumeIndex
                );
            }
        });
        
        document.getElementById('next-chapter').addEventListener('click', async function() {
            const currentVolume = currentNovel.volumes[currentVolumeIndex];
            if (currentChapterIndex < currentVolume.chapters.length - 1) {
                const nextChapter = currentVolume.chapters[currentChapterIndex + 1];
                await showChapterContent(
                    currentNovel.title,
                    currentVolume.title,
                    nextChapter,
                    currentChapterIndex + 1,
                    currentVolumeIndex
                );
            }
        });

            /**
         * 更新阅读器导航按钮状态
         */
        function updateReaderNavButtons() {
            const prevBtn = document.getElementById('prev-chapter');
            const nextBtn = document.getElementById('next-chapter');
            
            // 上一章按钮状态
            prevBtn.disabled = currentChapterIndex <= 0;
            
            // 下一章按钮状态
            const currentVolume = currentNovel.volumes[currentVolumeIndex];
            nextBtn.disabled = currentChapterIndex >= currentVolume.chapters.length - 1;
        }

        /**
         * 设置导航链接事件
         */
        function setupNavigation() {
            // 非虚构小说 - 只显示第一本
            fictionLink.addEventListener('click', function(e) {
                e.preventDefault();
                novelSection.style.display = 'block';
                aboutSection.style.display = 'none';
                
                const nonFictionNovel = novelsData.filter(novel => novel.id === 1);
                renderNovels(nonFictionNovel);
                
                window.scrollTo({
                    top: novelSection.offsetTop - 20,
                    behavior: 'smooth'
                });
            });
            
            // 虚构小说 - 显示第二和第三本
            fictionAllLink.addEventListener('click', function(e) {
                e.preventDefault();
                novelSection.style.display = 'block';
                aboutSection.style.display = 'none';
                
                const fictionNovels = novelsData.filter(novel => novel.id !== 1);
                renderNovels(fictionNovels);
                
                window.scrollTo({
                    top: novelSection.offsetTop - 20,
                    behavior: 'smooth'
                });
            });
            
            // 关于页面
            aboutLink.addEventListener('click', function(e) {
                e.preventDefault();
                novelSection.style.display = 'none';
                aboutSection.style.display = 'block';
                
                window.scrollTo({
                    top: aboutSection.offsetTop - 20,
                    behavior: 'smooth'
                });
            });
        }

        // 添加首页链接功能
        function setupHomeLink() {
            homeLink.addEventListener('click', function(e) {
                e.preventDefault();
                
                // 隐藏所有特殊页面
                novelSection.style.display = 'block';
                aboutSection.style.display = 'none';
                
                // 显示所有小说
                renderNovels(novelsData);
                
                // 滚动到顶部
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                
                // 清空搜索框
                searchInput.value = '';
            });
        }

        /**
         * 设置搜索功能
         */
        function setupSearch() {
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                
                if (searchTerm === '') {
                    renderNovels(novelsData);
                    return;
                }
                
                const filteredNovels = novelsData.filter(novel => {
                    return novel.title.toLowerCase().includes(searchTerm) ||
                           novel.description.toLowerCase().includes(searchTerm) ||
                           novel.tags.some(tag => tag.toLowerCase().includes(searchTerm));
                });
                
                renderNovels(filteredNovels);
            });
        }

        /**
         * 设置模态框关闭事件
         */
        function setupModalClose() {
            // 点击关闭按钮
            closeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    novelModal.style.display = 'none';
                    fullscreenReader.style.display = 'none';
                    clearRainEffect();
                });
            });
            
            // 点击模态框外部关闭
            window.addEventListener('click', function(e) {
                if (e.target === novelModal) {
                    novelModal.style.display = 'none';
                }
                if (e.target === fullscreenReader) {
                    fullscreenReader.style.display = 'none';
                    clearRainEffect();
                }
            });
            
            // 按ESC键关闭
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && fullscreenReader.style.display === 'block') {
                    fullscreenReader.style.display = 'none';
                    clearRainEffect();
                }
            });
        }

        /**
         * 初始化阅读器控制
         */
        function initReaderControls() {
            // 关闭阅读器
            document.getElementById('close-reader').addEventListener('click', function() {
                fullscreenReader.style.display = 'none';
                clearRainEffect();
            });
            
            // 返回目录
            document.getElementById('back-to-volumes').addEventListener('click', function() {
                fullscreenReader.style.display = 'none';
                clearRainEffect();
                showNovelDetails(currentNovel.id);
            });
            
            // 上一章
            document.getElementById('prev-chapter').addEventListener('click', function() {
                if (currentChapterIndex > 0) {
                    const prevChapter = currentNovel.volumes[currentVolumeIndex].chapters[currentChapterIndex - 1];
                    showChapterContent(
                        currentNovel.title,
                        currentNovel.volumes[currentVolumeIndex].title,
                        prevChapter,
                        currentChapterIndex - 1,
                        currentVolumeIndex
                    );
                }
            });
            
            // 下一章
            document.getElementById('next-chapter').addEventListener('click', function() {
                const currentVolume = currentNovel.volumes[currentVolumeIndex];
                if (currentChapterIndex < currentVolume.chapters.length - 1) {
                    const nextChapter = currentVolume.chapters[currentChapterIndex + 1];
                    showChapterContent(
                        currentNovel.title,
                        currentVolume.title,
                        nextChapter,
                        currentChapterIndex + 1,
                        currentVolumeIndex
                    );
                }
            });
        }

        // 新增下拉阅读功能
        function initPullToRead() {
            const reader = document.getElementById('fullscreen-reader');
            let startY = 0;
            let currentY = 0;
            let isDragging = false;
            let currentScrollTop = 0;

            reader.addEventListener('touchstart', (e) => {
                currentScrollTop = window.scrollY;
                if (currentScrollTop === 0) {
                    startY = e.touches[0].pageY;
                    isDragging = true;
                }
            }, { passive: true });

            reader.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                
                currentY = e.touches[0].pageY;
                const deltaY = currentY - startY;
                
                // 只有在下拉时才处理
                if (deltaY > 0 && currentScrollTop === 0) {
                    e.preventDefault();
                    
                    // 计算阻尼效果
                    const dragPercent = Math.min(1, deltaY / window.innerHeight);
                    const dragOffset = dragPercent * 100;
                    
                    // 应用视觉反馈
                    document.getElementById('reader-content').style.transform = `translateY(${dragOffset}px)`;
                    
                    // 当下拉足够距离时加载上一章
                    if (dragPercent > 0.3) {
                        loadPreviousChapter();
                        isDragging = false;
                    }
                }
            }, { passive: false });

            reader.addEventListener('touchend', () => {
                if (!isDragging) return;
                
                // 恢复原位
                document.getElementById('reader-content').style.transform = 'translateY(0)';
                isDragging = false;
            }, { passive: true });
        }

        function loadPreviousChapter() {
            if (currentChapterIndex > 0) {
                const prevChapter = currentNovel.volumes[currentVolumeIndex].chapters[currentChapterIndex - 1];
                showChapterContent(
                    currentNovel.title,
                    currentNovel.volumes[currentVolumeIndex].title,
                    prevChapter,
                    currentChapterIndex - 1,
                    currentVolumeIndex
                );
            } else {
                // 已经是第一章，回弹效果
                const readerContent = document.getElementById('reader-content');
                readerContent.style.transition = 'transform 0.5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                readerContent.style.transform = 'translateY(0)';
                
                setTimeout(() => {
                    readerContent.style.transition = '';
                }, 500);
            }
        }
            
        /**
         * 初始化Valine评论系统
         */
        function initValine(novelTitle, volumeTitle, chapterTitle) {
            // 生成唯一ID（确保长度不超过50）
            const id = `${currentNovelId}-${currentVolumeIndex}-${currentChapterIndex}`.substring(0, 50);
            
            // 设置页面路径
            valineConfig.path = `/novel/${currentNovelId}/volume/${currentVolumeIndex}/chapter/${currentChapterIndex}`;
            
            // 如果Valine实例已存在，先销毁
            if (valineInstance) {
                const vcomments = document.getElementById('vcomments');
                vcomments.innerHTML = '';
            }
            
            // 初始化Valine
            valineInstance = new Valine({
                ...valineConfig,
                el: '#vcomments',
                path: valineConfig.path,
                placeholder: `欢迎评论《${novelTitle} - ${volumeTitle} - ${chapterTitle}》~ (支持Markdown语法)`
            });
            
            // 初始化后添加删除功能
            setTimeout(() => {
                addDeleteFunctionality();
                observeCommentsChanges(); // 监听评论变化
            }, 1000);
        }

        // 添加删除功能
        function addDeleteFunctionality() {
            const comments = document.querySelectorAll('.vcard');
            comments.forEach(comment => {
                addDeleteButtonToComment(comment);
            });
        }

        // 为评论添加删除按钮
        function addDeleteButtonToComment(commentElement) {
            // 检查是否已添加删除按钮
            if (commentElement.querySelector('.comment-delete-btn')) return;
            
            const commentId = commentElement.getAttribute('id');
            if (!commentId) return;
            
            // 获取评论作者信息
            const authorElement = commentElement.querySelector('.vnick');
            if (!authorElement) return;
            const authorName = authorElement.textContent;
            
            // 获取评论邮箱（用于识别当前用户）
            const mailElement = commentElement.querySelector('.vmail');
            const authorMail = mailElement ? mailElement.getAttribute('href')?.replace('mailto:', '') : '';
            
            // 获取当前登录用户
            const currentUser = getCurrentUser();
            const isAdmin = currentUser && adminEmails.includes(currentUser.email);
            const isAuthor = currentUser && authorMail === currentUser.email;
            
            // 只有管理员或作者才能看到删除按钮
            if (isAdmin || isAuthor) {
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'comment-delete-btn';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = '删除评论';
                deleteBtn.onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    deleteComment(commentId.replace('comment-', ''), commentElement);
                };
                
                // 找到评论操作区域添加删除按钮
                const actionArea = commentElement.querySelector('.vmeta');
                if (actionArea) {
                    // 添加一些样式
                    deleteBtn.style.background = 'none';
                    deleteBtn.style.border = 'none';
                    deleteBtn.style.color = '#e74c3c';
                    deleteBtn.style.cursor = 'pointer';
                    deleteBtn.style.marginLeft = '10px';
                    actionArea.appendChild(deleteBtn);
                }
            }
        }

        // 获取当前用户信息
        function getCurrentUser() {
            try {
                // Valine将用户信息存储在localStorage
                const userStr = localStorage.getItem('LEANCLOUD_USER');
                if (userStr) {
                    return JSON.parse(userStr);
                }
            } catch (e) {
                console.error('获取用户信息失败', e);
            }
            return null;
        }

        // 删除评论函数
        function deleteComment(commentId, commentElement) {
            if (!confirm('确定要删除这条评论吗？此操作不可恢复。')) return;
            
            // 使用LeanCloud API删除评论
            const Comment = AV.Object.extend('Comment');
            const query = new AV.Query(Comment);
            
            query.get(commentId).then((comment) => {
                return comment.destroy();
            }).then(() => {
                // 删除成功，从UI中移除评论
                commentElement.style.opacity = '0.5';
                setTimeout(() => {
                    commentElement.remove();
                    // 如果没有评论了，显示提示
                    if (document.querySelectorAll('.vcard').length === 0) {
                        document.querySelector('#vcomments').innerHTML = 
                            '<div class="no-comments">暂无评论</div>';
                    }
                }, 500);
                
                // 显示成功消息
                showMessage('评论已删除', 'success');
            }).catch((error) => {
                console.error('删除评论失败:', error);
                showMessage('删除评论失败: ' + error.message, 'error');
            });
        }

        // 显示消息提示
        function showMessage(message, type = 'info') {
            // 移除现有消息
            const existingMsg = document.querySelector('.comment-message');
            if (existingMsg) existingMsg.remove();
            
            const msgDiv = document.createElement('div');
            msgDiv.className = `comment-message comment-${type}`;
            msgDiv.textContent = message;
            msgDiv.style.position = 'fixed';
            msgDiv.style.top = '20px';
            msgDiv.style.right = '20px';
            msgDiv.style.padding = '10px 15px';
            msgDiv.style.borderRadius = '5px';
            msgDiv.style.zIndex = '10000';
            msgDiv.style.color = 'white';
            msgDiv.style.fontWeight = 'bold';
            
            if (type === 'success') {
                msgDiv.style.background = '#27ae60';
            } else if (type === 'error') {
                msgDiv.style.background = '#e74c3c';
            } else {
                msgDiv.style.background = '#3498db';
            }
            
            document.body.appendChild(msgDiv);
            
            // 3秒后自动消失
            setTimeout(() => {
                msgDiv.style.opacity = '0';
                msgDiv.style.transition = 'opacity 0.5s';
                setTimeout(() => msgDiv.remove(), 500);
            }, 3000);
        }

        // 监听评论变化（新评论添加）
        function observeCommentsChanges() {
            const targetNode = document.getElementById('vcomments');
            if (!targetNode) return;
            
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.addedNodes.length) {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1 && node.classList.contains('vcard')) {
                                setTimeout(() => {
                                    addDeleteButtonToComment(node);
                                }, 100);
                            }
                        });
                    }
                });
            });
            
            observer.observe(targetNode, { childList: true, subtree: true });
        }
    </script>
</body>
</html>
    
